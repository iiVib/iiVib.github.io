<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ูุนุจุฉ ุงูุดุฎุตูุงุช - ุชุณุฌูู ุงูุฏุฎูู</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- ุดุงุดุฉ ุงูุจุฏุงูุฉ -->
    <div id="startScreen" class="screen active">
        <div class="start-container">
            <div class="start-header">
                <h1>โก ูุนุจุฉ ุงุฎุชูุงุฑ ุงูุดุฎุตูุงุช โก</h1>
                <p>Jujutsu Kaisen Battle Arena</p>
            </div>

            <div class="start-buttons">
                <button class="start-btn create-btn" onclick="createGame()">
                    <span class="btn-icon">๐</span>
                    <span class="btn-text">ุฅูุดุงุก ุบุฑูุฉ ุฌุฏูุฏุฉ</span>
                </button>

                <button class="start-btn join-btn" onclick="showJoinForm()">
                    <span class="btn-icon">๐</span>
                    <span class="btn-text">ุงูุงูุถูุงู ุฅูู ุบุฑูุฉ</span>
                </button>
            </div>
        </div>
    </div>

    <!-- ุดุงุดุฉ ุงูุงูุชุธุงุฑ (ููุดุฆ ุงูุบุฑูุฉ) -->
    <div id="waitingScreen" class="screen">
        <div class="waiting-container">
            <div class="waiting-header">
                <h2>โณ ูู ุงูุชุธุงุฑ ูุงุนุจ ุขุฎุฑ</h2>
            </div>

            <div class="code-section">
                <p class="code-label">ุดุงุฑู ูุฐุง ุงูููุฏ ูุน ุตุฏููู:</p>
                <div class="code-display">
                    <input type="text" id="gameCode" readonly class="code-input">
                    <button class="copy-btn" onclick="copyCode()">๐ ูุณุฎ</button>
                </div>
            </div>

            <div class="player-info">
                <p>ุฃูุช ุงููุงุนุจ ุงูุฃูู ๐ค</p>
                <p id="statusMessage">ูู ุงูุชุธุงุฑ ุงููุงุนุจ ุงูุซุงูู...</p>
            </div>

            <button class="cancel-btn" onclick="goBack()">ุงูุนูุฏุฉ</button>
        </div>
    </div>

    <!-- ุดุงุดุฉ ุงูุงูุถูุงู -->
    <div id="joinScreen" class="screen">
        <div class="join-container">
            <div class="join-header">
                <h2>ุงูุงูุถูุงู ุฅูู ุบุฑูุฉ</h2>
            </div>

            <div class="join-form">
                <input type="text" id="joinCode" placeholder="ุฃุฏุฎู ุงูููุฏ ููุง..." class="code-input">
                <button class="join-btn-form" onclick="joinGame()">ุงูุงูุถูุงู ๐ฎ</button>
            </div>

            <button class="cancel-btn" onclick="goBack()">ุงูุนูุฏุฉ</button>
        </div>
    </div>

    <!-- Background Music -->
    <audio id="bgMusic" autoplay loop>
        <source src="musics/jjk-music/track1.mp3" type="audio/mpeg">
    </audio>

    <!-- Music Control Panel -->
    <div class="music-control-panel">
        <!-- Music Toggle Button -->
        <button id="musicToggle" class="music-toggle" title="ุชุดุบูู/ุฅููุงู ุงูููุณููู">
            ๐
        </button>

        <!-- OST Selector Button -->
        <button class="ost-selector-btn" onclick="showOSTMenu()" title="ุงุฎุชุฑ ุงูููุณููู">
            ๐ต
        </button>

        <!-- Volume Control -->
        <div class="volume-control" id="volumeControl" style="display: none;">
            <span class="volume-icon">๐</span>
            <input type="range" id="volumeSlider" min="0" max="1" step="0.1" value="0.5">
            <span id="volumeLabel">50%</span>
        </div>
    </div>

    <!-- OST Menu Modal -->
    <div id="ostModal" class="ost-modal">
        <div class="ost-modal-content">
            <span class="ost-close" onclick="closeOSTMenu()">&times;</span>
            <h2>ุงุฎุชุฑ ุงูููุณููู ๐ต</h2>
            
            <div class="ost-list">
                <!-- Jujutsu Kaisen OST -->
                <div class="ost-item">
                    <button class="ost-main-btn" onclick="toggleOSTSubmenu('jjk')">
                        Jujutsu Kaisen OST ๐ฅ
                    </button>
                    <div id="jjk-submenu" class="ost-submenu" style="display: none;">
                        <button class="ost-sub-btn" onclick="selectOST('musics/jjk-music', 'Jujutsu Kaisen (English)')">
                            ๐ฌ๐ง ุงููุณุฎุฉ ุงูุฅูุฌููุฒูุฉ
                        </button>
                        <button class="ost-sub-btn" onclick="selectOST('musics/jjk-music-ar', 'Jujutsu Kaisen (Arabic)')">
                            ๐ธ๐ฆ ุงููุณุฎุฉ ุงูุนุฑุจูุฉ
                        </button>
                    </div>
                </div>

                <!-- Youjo Senki OST -->
                <div class="ost-item">
                    <button class="ost-main-btn" onclick="selectOST('musics/senki-music', 'Youjo Senki OST')">
                        Youjo Senki OST โ๏ธ
                    </button>
                </div>

                <!-- Mahoraga vs Sukuna OST -->
                <div class="ost-item">
                    <button class="ost-main-btn" onclick="selectOST('musics/mahoragavssukuna-music', 'Mahoraga vs Sukuna')">
                        Mahoraga vs Sukuna OST โก
                    </button>
                </div>
            </div>

            <div class="ost-current">
                <p>ุงูููุณููู ุงูุญุงููุฉ: <span id="currentOST">Jujutsu Kaisen (English)</span></p>
            </div>
        </div>
    </div>

    <script>
        let currentGameCode = null;
        let currentRole = null;
        let isMusicPlaying = true;
        let currentOSTPath = 'musics/jjk-music';
        let currentOSTName = 'Jujutsu Kaisen (English)';

        const bgMusic = document.getElementById('bgMusic');
        const musicToggle = document.getElementById('musicToggle');
        const volumeSlider = document.getElementById('volumeSlider');
        const volumeLabel = document.getElementById('volumeLabel');
        const volumeControl = document.getElementById('volumeControl');
        const ostModal = document.getElementById('ostModal');

        // ุฅุนุฏุงุฏุงุช ุงูุตูุช
        bgMusic.volume = 0.5;

        // ุชุดุบูู/ุฅููุงู ุงูููุณููู
        musicToggle.addEventListener('click', function() {
            if (isMusicPlaying) {
                bgMusic.pause();
                musicToggle.textContent = '๐';
                musicToggle.style.background = 'linear-gradient(135deg, #666666 0%, #444444 100%)';
                isMusicPlaying = false;
            } else {
                bgMusic.play();
                musicToggle.textContent = '๐';
                musicToggle.style.background = 'linear-gradient(135deg, #FF3D3D 0%, #CC0000 100%)';
                isMusicPlaying = true;
            }
        });

        // ุงูุชุญูู ูู ูุณุชูู ุงูุตูุช
        volumeSlider.addEventListener('input', function() {
            bgMusic.volume = this.value;
            volumeLabel.textContent = Math.round(this.value * 100) + '%';
        });

        // ุนุฑุถ/ุฅุฎูุงุก ุงูุชุญูู ูู ูุณุชูู ุงูุตูุช
        document.querySelector('.ost-selector-btn').addEventListener('click', function() {
            volumeControl.style.display = volumeControl.style.display === 'none' ? 'flex' : 'none';
        });

        // ุนุฑุถ ูุงุฆูุฉ ุงูููุณููู
        function showOSTMenu() {
            ostModal.style.display = 'block';
            volumeControl.style.display = 'none';
        }

        // ุฅุบูุงู ูุงุฆูุฉ ุงูููุณููู
        function closeOSTMenu() {
            ostModal.style.display = 'none';
        }

        // ุชุจุฏูู ุงููุงุฆูุฉ ุงููุฑุนูุฉ
        function toggleOSTSubmenu(menu) {
            const submenu = document.getElementById(menu + '-submenu');
            submenu.style.display = submenu.style.display === 'none' ? 'block' : 'none';
        }

        // ุงุฎุชูุงุฑ ุงูููุณููู
        function selectOST(path, name) {
            currentOSTPath = path;
            currentOSTName = name;
            
            // ุชุญุฏูุซ ุงูููุณููู
            const currentTime = bgMusic.currentTime;
            bgMusic.src = path + '/track1.mp3';
            bgMusic.currentTime = 0;
            
            if (isMusicPlaying) {
                bgMusic.play();
            }

            document.getElementById('currentOST').textContent = name;
            closeOSTMenu();
            
            // ุญูุธ ุงูุงุฎุชูุงุฑ
            localStorage.setItem('selectedOST', JSON.stringify({path, name}));
        }

        // ุฅุบูุงู ุงูููุฏุงู ุนูุฏ ุงูุถุบุท ุฎุงุฑุฌู
        window.onclick = function(event) {
            if (event.target == ostModal) {
                ostModal.style.display = 'none';
            }
        }

        // ุชุญููู ุงูููุณููู ุงููุญููุธุฉ
        function loadSavedOST() {
            const saved = localStorage.getItem('selectedOST');
            if (saved) {
                const {path, name} = JSON.parse(saved);
                currentOSTPath = path;
                currentOSTName = name;
                bgMusic.src = path + '/track1.mp3';
                document.getElementById('currentOST').textContent = name;
            }
        }

        // ุฏูุงู ุงููุนุจุฉ ุงูุฃุตููุฉ
        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            document.getElementById(screenId).classList.add('active');
        }

        function createGame() {
            currentGameCode = generateGameCode();
            currentRole = 1;
            document.getElementById('gameCode').value = currentGameCode;
            showScreen('waitingScreen');
            
            let rooms = getActiveRooms();
            rooms[currentGameCode] = {
                code: currentGameCode,
                player1: {
                    role: 1,
                    selected: []
                },
                player2: null,
                createdAt: Date.now()
            };
            localStorage.setItem('activeRooms', JSON.stringify(rooms));
            
            startWaitingPoll();
        }

        function generateGameCode() {
            return Math.random().toString(36).substring(2, 8).toUpperCase();
        }

        function getActiveRooms() {
            const rooms = localStorage.getItem('activeRooms');
            return rooms ? JSON.parse(rooms) : {};
        }

        function copyCode() {
            const codeInput = document.getElementById('gameCode');
            codeInput.select();
            document.execCommand('copy');
            alert('ุชู ูุณุฎ ุงูููุฏ! ๐');
        }

        function showJoinForm() {
            showScreen('joinScreen');
        }

        function joinGame() {
            const code = document.getElementById('joinCode').value.trim().toUpperCase();
            if (code.length === 6) {
                let rooms = getActiveRooms();
                
                if (rooms[code]) {
                    currentGameCode = code;
                    currentRole = 2;
                    
                    rooms[code].player2 = {
                        role: 2,
                        selected: []
                    };
                    localStorage.setItem('activeRooms', JSON.stringify(rooms));
                    
                    goToGame();
                } else {
                    alert('ุงูููุฏ ุบูุฑ ุตุญูุญ ุฃู ุงูุชูุช ุตูุงุญูุชู');
                }
            } else {
                alert('ุงูุฑุฌุงุก ุฅุฏุฎุงู ููุฏ ุตุญูุญ (6 ุฃุญุฑู)');
            }
        }

        function goToGame() {
            sessionStorage.setItem('gameCode', currentGameCode);
            sessionStorage.setItem('playerRole', currentRole);
            sessionStorage.setItem('ostPath', currentOSTPath);
            sessionStorage.setItem('ostName', currentOSTName);
            window.location.href = 'game.html';
        }

        function startWaitingPoll() {
            const pollInterval = setInterval(() => {
                let rooms = getActiveRooms();
                if (rooms[currentGameCode] && rooms[currentGameCode].player2) {
                    clearInterval(pollInterval);
                    document.getElementById('statusMessage').textContent = 'โ ุชู ุงูุงุชุตุงู ุจูุงุนุจ ุขุฎุฑ!';
                    setTimeout(() => {
                        goToGame();
                    }, 1500);
                }
            }, 1000);

            setTimeout(() => {
                clearInterval(pollInterval);
            }, 30 * 60 * 1000);
        }

        function goBack() {
            currentGameCode = null;
            currentRole = null;
            showScreen('startScreen');
            document.getElementById('joinCode').value = '';
        }

        // ุชุญููู ุงูููุณููู ุงููุญููุธุฉ ุนูุฏ ูุชุญ ุงูุตูุญุฉ
        loadSavedOST();
    </script>
</body>
</html>
