<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ูุนุจุฉ ุงูุดุฎุตูุงุช - ุชุณุฌูู ุงูุฏุฎูู</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- ุดุงุดุฉ ุงูุจุฏุงูุฉ -->
    <div id="startScreen" class="screen active">
        <div class="start-container">
            <div class="start-header">
                <h1>๐ฎ ูุนุจุฉ ุงุฎุชูุงุฑ ุงูุดุฎุตูุงุช</h1>
                <p>ุงูุนุจ ูุน ุฃุตุฏูุงุฆู ุฃูููุงูู</p>
            </div>

            <div class="start-buttons">
                <button class="start-btn create-btn" onclick="createGame()">
                    <span class="btn-icon">๐</span>
                    <span class="btn-text">ุฅูุดุงุก ุบุฑูุฉ ุฌุฏูุฏุฉ</span>
                </button>

                <button class="start-btn join-btn" onclick="showJoinForm()">
                    <span class="btn-icon">๐</span>
                    <span class="btn-text">ุงูุงูุถูุงู ุฅูู ุบุฑูุฉ</span>
                </button>
            </div>
        </div>
    </div>

    <!-- ุดุงุดุฉ ุงูุงูุชุธุงุฑ (ููุดุฆ ุงูุบุฑูุฉ) -->
    <div id="waitingScreen" class="screen">
        <div class="waiting-container">
            <div class="waiting-header">
                <h2>โณ ูู ุงูุชุธุงุฑ ูุงุนุจ ุขุฎุฑ</h2>
            </div>

            <div class="code-section">
                <p class="code-label">ุดุงุฑู ูุฐุง ุงูููุฏ ูุน ุตุฏููู:</p>
                <div class="code-display">
                    <input type="text" id="gameCode" readonly class="code-input">
                    <button class="copy-btn" onclick="copyCode()">๐ ูุณุฎ</button>
                </div>
            </div>

            <div class="player-info">
                <p>ุฃูุช ุงููุงุนุจ ุงูุฃูู ๐ค</p>
                <p id="statusMessage">ูู ุงูุชุธุงุฑ ุงููุงุนุจ ๏ฟฝ๏ฟฝูุซุงูู...</p>
            </div>

            <button class="cancel-btn" onclick="goBack()">ุงูุนูุฏุฉ</button>
        </div>
    </div>

    <!-- ุดุงุดุฉ ุงูุงูุถูุงู -->
    <div id="joinScreen" class="screen">
        <div class="join-container">
            <div class="join-header">
                <h2>ุงูุงูุถูุงู ุฅูู ุบุฑูุฉ</h2>
            </div>

            <div class="join-form">
                <input type="text" id="joinCode" placeholder="ุฃุฏุฎู ุงูููุฏ ููุง..." class="code-input">
                <button class="join-btn-form" onclick="joinGame()">ุงูุงูุถูุงู ๐ฎ</button>
            </div>

            <button class="cancel-btn" onclick="goBack()">ุงูุนูุฏุฉ</button>
        </div>
    </div>

    <script>
        let currentGameCode = null;
        let currentRole = null;

        // ุฏูุงู ุฅุฏุงุฑุฉ ุงูุดุงุดุงุช
        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            document.getElementById(screenId).classList.add('active');
        }

        // ุฅูุดุงุก ูุนุจุฉ ุฌุฏูุฏุฉ
        function createGame() {
            currentGameCode = generateGameCode();
            currentRole = 1;
            document.getElementById('gameCode').value = currentGameCode;
            showScreen('waitingScreen');
            
            // ุญูุธ ุงูููุฏ ูู localStorage
            localStorage.setItem('activeRooms', JSON.stringify(getActiveRooms()));
            let rooms = getActiveRooms();
            rooms[currentGameCode] = {
                code: currentGameCode,
                player1: {
                    role: 1,
                    selected: []
                },
                player2: null,
                createdAt: Date.now()
            };
            localStorage.setItem('activeRooms', JSON.stringify(rooms));
            
            // ุจุฏุก ุงูุงุณุชุทูุงุน ููุชุญูู ูู ุงูุถูุงู ูุงุนุจ ุขุฎุฑ
            startWaitingPoll();
        }

        // ุชูููุฏ ููุฏ ุนุดูุงุฆู
        function generateGameCode() {
            return Math.random().toString(36).substring(2, 8).toUpperCase();
        }

        // ุงูุญุตูู ุนูู ุงูุบุฑู ุงููุดุทุฉ
        function getActiveRooms() {
            const rooms = localStorage.getItem('activeRooms');
            return rooms ? JSON.parse(rooms) : {};
        }

        // ูุณุฎ ุงูููุฏ
        function copyCode() {
            const codeInput = document.getElementById('gameCode');
            codeInput.select();
            document.execCommand('copy');
            alert('ุชู ูุณุฎ ุงูููุฏ! ๐');
        }

        // ุนุฑุถ ูููุฐุฌ ุงูุงูุถูุงู
        function showJoinForm() {
            showScreen('joinScreen');
        }

        // ุงูุงูุถูุงู ุฅูู ูุนุจุฉ
        function joinGame() {
            const code = document.getElementById('joinCode').value.trim().toUpperCase();
            if (code.length === 6) {
                let rooms = getActiveRooms();
                
                if (rooms[code]) {
                    currentGameCode = code;
                    currentRole = 2; // ุงููุงุนุจ ุงูุซุงูู ุฏุงุฆูุงู
                    
                    // ุชุญุฏูุซ ุงูุบุฑูุฉ
                    rooms[code].player2 = {
                        role: 2,
                        selected: []
                    };
                    localStorage.setItem('activeRooms', JSON.stringify(rooms));
                    
                    // ุงูุงูุชูุงู ููุนุจุฉ
                    goToGame();
                } else {
                    alert('ุงูููุฏ ุบูุฑ ุตุญูุญ ุฃู ุงูุชูุช ุตูุงุญูุชู');
                }
            } else {
                alert('ุงูุฑุฌุงุก ุฅุฏุฎุงู ููุฏ ุตุญูุญ (6 ุฃุญุฑู)');
            }
        }

        // ุงูุงูุชูุงู ุฅูู ุงููุนุจุฉ
        function goToGame() {
            sessionStorage.setItem('gameCode', currentGameCode);
            sessionStorage.setItem('playerRole', currentRole);
            window.location.href = 'game.html';
        }

        // ุจุฏุก ุงุณุชุทูุงุน ุงูุงูุชุธุงุฑ
        function startWaitingPoll() {
            const pollInterval = setInterval(() => {
                let rooms = getActiveRooms();
                if (rooms[currentGameCode] && rooms[currentGameCode].player2) {
                    clearInterval(pollInterval);
                    document.getElementById('statusMessage').textContent = 'โ ุชู ุงูุงุชุตุงู ุจูุงุนุจ ุขุฎุฑ!';
                    setTimeout(() => {
                        goToGame();
                    }, 1500);
                }
            }, 1000);

            // ุฅููุงู ุงูุงุณุชุทูุงุน ุจุนุฏ 30 ุฏูููุฉ
            setTimeout(() => {
                clearInterval(pollInterval);
            }, 30 * 60 * 1000);
        }

        // ุงูุนูุฏุฉ ููุดุงุดุฉ ุงูุณุงุจูุฉ
        function goBack() {
            currentGameCode = null;
            currentRole = null;
            showScreen('startScreen');
            document.getElementById('joinCode').value = '';
        }
    </script>
</body>
</html>
